//Design Survey - Non-Anonymous
String surveyCode = 'Customer Retention';
String surveyTitle = 'CSR';
List<JBCXM__Survey__c> Surveys = new List<JBCXM__Survey__c>();
List<String> codes= new List<String> {surveyCode};
List<String> titles = new List<String> {surveyTitle};
public class ApplicationException  Extends Exception { }
try {
    JBCXM__Survey__c surveyDel =  [Select id from JBCXM__Survey__c Where JBCXM__Code__c =:surveyCode AND JBCXM__Title__c=:surveyTitle LIMIT 1];
    Delete [select id from JBCXM__SurveyQuestion__c Where JBCXM__SurveyMaster__c=:surveyDel.Id];
    Delete [select id from JBCXM__SurveyAllowedAnswers__c Where JBCXM__SurveyMaster__c =:surveyDel.Id];
    Delete [Select id from JBCXM__SurveyParticipant__c Where JBCXM__SurveyMaster__c =:surveyDel.Id];
    Delete [Select id from JBCXM__SurveyResponseTask__c Where JBCXM__Survey__c =:surveyDel.Id];
    Delete [Select id from JBCXM__SurveyUserAnswer__c Where JBCXM__SurveyMaster__c =:surveyDel.Id];
    Delete [Select id from JBCXM__SurveyDistributionSchedule__c Where JBCXM__SurveyId__c =:surveyDel.Id];
    Delete [Select id from JBCXM__SurveyLogicRules__c Where JBCXM__SurveyMaster__c =:surveyDel.Id];
    Delete [select id from JBCXM__Survey__c Where id=:surveyDel.Id];
} catch(System.Exception e) {
    system.debug('No Survey Found to delete');
}
JBCXM__Survey__c sur;
for(Integer i=0; i < codes.size();i++ ) {
	sur = new JBCXM__Survey__c (JBCXM__Code__c 			= codes.get(i) ,
                                    JBCXM__Title__c 		= titles.get(i) ,
                                    JBCXM__IsAnonymous__c	= false,
                                    JBCXM__StartDate__c		= Date.today(),
                                    JBCXM__EndDate__c		= Date.today().addMonths(1),
                                    JBCXM__ThankyouType__c	= 'message',
                                    JBCXM__FooterMessge__c	= 'If you have any comments or concerns about this survey please Contact: - [MANAGER_NAME],[phone]',
                                    JBCXM__Status__c 		= 'Design',
                                    SurMaster_ExternalID__c = codes.get(i),
                                    JBCXM__InternalSubmit__c	= false,
                                    JBCXM__Description__c		= 'Dear Customer:\n	As the manager of [COMPANY], I want to thank you for giving',
                                    JBCXM__ThankyouMessage__c	= 'Thank you for your feedback. We sincerely appreciate your honest opinion'+
																					' and will take your input into consideration while providing products and services in the future.');
	Surveys.add(sur);
}
insert Surveys;

//===========================================================================================================================================================//

 //Add Questions to Survey
 //JBCXM__SurveyQuestion__c
 List<JBCXM__SurveyQuestion__c>  surQuestions = new List<JBCXM__SurveyQuestion__c>();
 List<String> Questions = new List<String>{'How often do you typically use the product?',
 											'How did our PRODUCT perform?',
 											'Please share with us a few things [Product/Service] could do better.',
 											'Based on your experience with [PRODUCT], how likely are you to buy [PRODUCT] again?',
 											'What day/time of the day would you prefer our representatives to contact you?',
 											'Have you ever contacted customer service?',
 											'Did our representative... (Select all that apply)',
 											'What did we do really well?',
 											'What can we do to be even better?',
 											'What Services offered by us , impressed you the most?',
 											'Please Rank the Services provided by us :',
 											'Please Select the features you use or would like to use in our product',
 											'How likely are you to recommend our Product to others?'};

List<String> QTypes =new List<String>{'Radio', 'MatrixSingleAnswer','Comment',
										'SingleSelect','Checkbox','Radio',
										'MultiSelect','Text','Text','Checkbox',
										'Ranking','MatrixMultipleAnswers','NPS'} ;

  for( Integer qNo=0;qNo<Questions.size();qNo++)
 {
			if(!QTypes.get(qNo).equals('NPS'))
					{
						surQuestions.add(new JBCXM__SurveyQuestion__c(JBCXM__SurveyMaster__c    = sur.Id,
						                                            JBCXM__IsActive__c          = true,
						                                            JBCXM__IsRequired__c        = false,
						                                            JBCXM__Title__c             = Questions.get(qNo),
						                                            JBCXM__DisplayOrder__c      = qNo+1,
						                                            JBCXM__Type__c              = QTypes.get(qNo),
						                                            SurQues_ExternalID__c       = sur.SurMaster_ExternalID__c+'_'+QTypes.get(qNo)+(qNo+1)));
					}
			else
			{
					surQuestions.add(new JBCXM__SurveyQuestion__c(JBCXM__SurveyMaster__c    = sur.Id,
					                                            JBCXM__IsActive__c          = true,
					                                            JBCXM__IsRequired__c        = true,
					                                            JBCXM__Title__c             = Questions.get(qNo),
					                                            JBCXM__DisplayOrder__c      = qNo+1,
					                                            JBCXM__Type__c              = QTypes.get(qNo),
					                                            JBCXM__AllowComment__c      = true,
					                                            JBCXM__AllowHeaderGrouping__c=true,
					                                            JBCXM__CommentLabel__c      = 'Please tell us why?',
					                                            JBCXM__GroupHeaderType__c   = 'Text',
					                                            SurQues_ExternalID__c       = sur.SurMaster_ExternalID__c+'_'+QTypes.get(qNo)+(qNo+1)));
		    }

}
insert surQuestions;
//===========================================================================================================================================================//
//Sub Questions for questions of Matrix type

List<JBCXM__SurveyQuestion__c>  surSubQuestions	= new List<JBCXM__SurveyQuestion__c>();
JBCXM__SurveyQuestion__c MatrixSingleSelect 	= [Select Id, Name, JBCXM__DisplayOrder__c, JBCXM__Type__c
													From JBCXM__SurveyQuestion__c Where JBCXM__Type__c = 'MatrixSingleAnswer'
													AND JBCXM__SurveyMaster__c IN (Select Id From JBCXM__Survey__c
														Where JBCXM__Code__c =: surveyCode AND JBCXM__Title__c=:surveyTitle )];
JBCXM__SurveyQuestion__c MatrixMultiSelect 		= [Select Name, JBCXM__DisplayOrder__c, JBCXM__Type__c From
													JBCXM__SurveyQuestion__c Where JBCXM__Type__c = 'MatrixMultipleAnswers'
													AND JBCXM__SurveyMaster__c IN (Select Id From JBCXM__Survey__c
														Where JBCXM__Code__c =: surveyCode AND JBCXM__Title__c=:surveyTitle)];
List<String> mSingle = new List<String>{'Overall quality', 'Value', 'Purchase experience',
											'Installation or first use experience', 'Usage experience',
											'After purchase service (warranty,repair,customer service etc)'};
List<String> mMultiple= new List<String>{'Engage','Promote'};
Integer qNo=0;
for(String ms : mSingle) {
   surSubQuestions.add(new JBCXM__SurveyQuestion__c(JBCXM__SurveyMaster__c		= sur.Id,
   														JBCXM__IsActive__c		= true,
   														JBCXM__IsRequired__c	= true,
   														JBCXM__Title__c			= ms,
   														JBCXM__DisplayOrder__c 	= qNo+1,
   														JBCXM__Type__c 			= 'Radio',
   														JBCXM__ParentQuestion__c= MatrixSingleSelect.Id,
   														SurQues_ExternalID__c	= sur.SurMaster_ExternalID__c+'_'+MatrixSingleSelect.JBCXM__Type__c+MatrixSingleSelect.JBCXM__DisplayOrder__c+'_Radio'+(qNo+1)));
   qNo++;
 }

 qNo=0;
for(String mm : mMultiple) {
	surSubQuestions.add(new JBCXM__SurveyQuestion__c(JBCXM__SurveyMaster__c		= sur.Id,
														JBCXM__IsActive__c 		= true,
														JBCXM__IsRequired__c	= true,
														JBCXM__Title__c			= mm,
														JBCXM__DisplayOrder__c	= qNo+1,
														JBCXM__Type__c 			= 'Checkbox',
														JBCXM__ParentQuestion__c= MatrixMultiSelect.Id,SurQues_ExternalID__c=sur.SurMaster_ExternalID__c+'_'+MatrixMultiSelect.JBCXM__Type__c+MatrixMultiSelect.JBCXM__DisplayOrder__c+'_Checkbox'+(qNo+1)));
	qNo++;
}

insert surSubQuestions;
//=======================================================================================================================================================//

//Inserting Allowed Answers
//JBCXM__SurveyAllowedAnswers__c

List<JBCXM__SurveyAllowedAnswers__c>  answersList = new List<JBCXM__SurveyAllowedAnswers__c>();
Integer ansOrder=0;
List<JBCXM__SurveyQuestion__c> que 		= [Select Id, Name, JBCXM__Type__c, SurQues_ExternalID__c From JBCXM__SurveyQuestion__c
											Where JBCXM__ParentQuestion__c = null AND JBCXM__SurveyMaster__c IN
											(Select Id from JBCXM__Survey__c Where JBCXM__Code__c =: surveyCode AND JBCXM__Title__c=:surveyTitle)  Order By JBCXM__DisplayOrder__c];
Map<JBCXM__SurveyQuestion__c,List<String>> qAndaMap = new Map<JBCXM__SurveyQuestion__c,List<String>>();
List<List<String>> answers=new List<List<String>> {new List<String>{'Daily','Weekly Once','Monthly Once','Once in 2-3 Months','Never'},
								new List<String>{'Miserably','Somewhat Satisfactory','Very Satisfactory','Delightfully'},
								new List<String>{''},
								new List<String>{'Definitely will','Probably will','Might or might not','Probably will not','Definitely will not'},
								new List<String>{'Weekdays','Weekends','Morning (6-10 AM)','Mid-day( 11- 4 PM)','Evenings (4-9 PM)','Any time of the day on Weekdays','Any time of the day on Weekends'},
								new List<String>{'Yes','No'},
								new List<String>{'Quickly identify the problem','Appear knowledgeable and competent','Help you understand the cause and the solution to the problem','Handle issues with courtesy and professionalism'},
								new List<String>{''},
								new List<String>{''},
								new List<String>{'Sales','Installation','Services','Customer Service Desk','All Services are very good','Liked none of our Services'},
								new List<String>{'Sales','Pre-Sales','Services','Customer Service Desk'},
								new List<String>{'CoreMotives','Email','Marketing Automation','Mobile Marketing','PlacePunch'},
								new List<String>{'0','1','2','3','4','5','6','7','8','9'}};
Integer qm=0;
for(JBCXM__SurveyQuestion__c q : que) {
	qAndaMap.put(q,answers.get(qm));
	qm++;
}

for(Integer m=0;m<qAndaMap.size();m++) {
   for(Integer an=0;an<qAndaMap.get(que.get(m)).size();an++) {
       if(!que.get(m).JBCXM__Type__c.equals('NPS')) {
			answersList.add(new JBCXM__SurveyAllowedAnswers__c(JBCXM__SurveyMaster__c 		= sur.Id,
																JBCXM__SurveyQuestion__c	= que.get(m).Id,
																JBCXM__Title__c				= qAndaMap.get(que.get(m)).get(an),
																JBCXM__DisplayOrder__c		= an+1,
																JBCXM__IsActive__c			= true,
																JBCXM__UserResponseCount__c	= 0,
																SurAllowAns_ExternalID__c	= que.get(m).SurQues_ExternalID__c+qAndaMap.get(que.get(m)).get(an)+'_ans'+(an+1)));
		} else {
			if(an<4) {
				answersList.add(new JBCXM__SurveyAllowedAnswers__c(JBCXM__SurveyMaster__c		= sur.Id,
																	JBCXM__SurveyQuestion__c	= que.get(m).Id,
																	JBCXM__Title__c				= qAndaMap.get(que.get(m)).get(an),
																	JBCXM__DisplayOrder__c		= an+1,
																	JBCXM__IsActive__c			= true,
																	JBCXM__UserResponseCount__c	= 0,
																	JBCXM__GroupLabel__c		= 'Not likely at all',
																	SurAllowAns_ExternalID__c 	= que.get(m).SurQues_ExternalID__c+qAndaMap.get(que.get(m)).get(an)+'_ans'+(an+1)));
			} else if(an>3 && an<8) {
				answersList.add(new JBCXM__SurveyAllowedAnswers__c(JBCXM__SurveyMaster__c		= sur.Id,
																	JBCXM__SurveyQuestion__c	= que.get(m).Id,
																	JBCXM__Title__c				= qAndaMap.get(que.get(m)).get(an),
																	JBCXM__DisplayOrder__c		= an+1,
																	JBCXM__IsActive__c			= true,
																	JBCXM__UserResponseCount__c	= 0,
																	JBCXM__GroupLabel__c		= 'Neutral',
																	SurAllowAns_ExternalID__c	= que.get(m).SurQues_ExternalID__c+qAndaMap.get(que.get(m)).get(an)+'_ans'+(an+1)));
			} else {
				answersList.add(new JBCXM__SurveyAllowedAnswers__c(JBCXM__SurveyMaster__c		= sur.Id,
																	JBCXM__SurveyQuestion__c	= que.get(m).Id,
																	JBCXM__Title__c				= qAndaMap.get(que.get(m)).get(an),
																	JBCXM__DisplayOrder__c		= an+1,
																	JBCXM__IsActive__c			= true,
																	JBCXM__UserResponseCount__c	= 0,
																	JBCXM__GroupLabel__c		= 'Extremely likely',
																	SurAllowAns_ExternalID__c	= que.get(m).SurQues_ExternalID__c+qAndaMap.get(que.get(m)).get(an)+'_ans'+(an+1)));
			}
		}
   }
}

insert answersList;