// Create Playbook Tasks for Opportunity Type Playbooks

List<JBCXM__GSMetaInfo__c> soid = [SELECT id FROM JBCXM__GSMetaInfo__c where JBCXM__SystemName__c like 'Skip_weekend_if_due_on_a_weekend%'];
List<JBCXM__GSMetaInfo__c> ddsid = [SELECT id,JBCXM__SystemName__c FROM JBCXM__GSMetaInfo__c where JBCXM__SystemName__c  in ('Assign_Date','CTA_DUE_DATE','NONE','TASK_CLOSE_DATE','TASK_DUE_DATE') ORDER BY JBCXM__SystemName__c ASC NULLS FIRST];
List<JBCXM__playbook__c> pbidforopportunity = [SELECT id FROM JBCXM__playbook__c where name like 'Opportunity__Playbook__%' limit 45];
integer noofplaybboktask_Opportunity =1;


for (JBCXM__playbook__c pidopportunity : pbidforopportunity) {
	List<JBCXM__playbooktasks__c> pbtaskList1to3_Opportunity = new List<JBCXM__playbooktasks__c>();
	List<JBCXM__playbooktasks__c> pbtaskList4_Opportunity = new List<JBCXM__playbooktasks__c>();
	List<JBCXM__playbooktasks__c> pbtaskList5_Opportunity = new List<JBCXM__playbooktasks__c>();

    integer randomNum = -30 + (integer)(Math.random() * (50 - (-30)));
	JBCXM__playbooktasks__c pbtask1_Opportunity = new JBCXM__playbooktasks__c (   //Task having Assign date as Date source Option
		JBCXM__PlaybookId__c = pidopportunity.id,
		JBCXM__DueDateSrc__c	=	ddsid.get(0).id,
		JBCXM__SkipOption__c = soid.get(0).id,
		JBCXM__DeltaDays__c = randomNum+.0,
		JBCXM__DisplayOrder__c = 1.0,
		JBCXM__Priority__c = 'High',
		JBCXM__Status__c = 'Open',
		JBCXM__Subject__c = 'ASSIGN_DATE_Skip_weekend_if_due_on_a_weekend_Opportunity_Playbook_'+(noofplaybboktask_Opportunity)
		);
		pbtaskList1to3_Opportunity.add(pbtask1_Opportunity);

	integer randomNum1 = 0 + (integer)(Math.random() * (10 - 0));
	JBCXM__playbooktasks__c pbtask2_Opportunity = new JBCXM__playbooktasks__c (  //Task having CTA due date as Date source Option
		JBCXM__PlaybookId__c = pidopportunity.id,
		JBCXM__DueDateSrc__c	=	ddsid.get(1).id,
		JBCXM__SkipOption__c = soid.get(0).id,
		JBCXM__DeltaDays__c = randomNum1+.0,
		JBCXM__DisplayOrder__c = 2.0,
		JBCXM__Priority__c = 'Medium',
		JBCXM__Status__c = 'Open',
		JBCXM__Subject__c = 'CTA_DUE_DATE_Skip_weekend_if_due_on_a_weekend_Opportunity_Playbook_'+(noofplaybboktask_Opportunity)
		);
		pbtaskList1to3_Opportunity.add(pbtask2_Opportunity);

	JBCXM__playbooktasks__c pbtask3_Opportunity = new JBCXM__playbooktasks__c (  //Task having None as Date source Option
		JBCXM__PlaybookId__c = pidopportunity.id,
		JBCXM__DueDateSrc__c	=	ddsid.get(2).id,
		JBCXM__DisplayOrder__c = 5.0,
		JBCXM__Priority__c = 'Low',
		JBCXM__Status__c = 'Open',
		JBCXM__Subject__c = 'NONE_Opportunity_Playbook_'+(noofplaybboktask_Opportunity)
		);
		pbtaskList1to3_Opportunity.add(pbtask3_Opportunity);
		insert pbtaskList1to3_Opportunity;


	List<JBCXM__playbooktasks__c> parentid = [SELECT id FROM JBCXM__playbooktasks__c where JBCXM__Subject__c =:pbtask2_Opportunity.JBCXM__Subject__c];
	JBCXM__playbooktasks__c pbtask4_Opportunity = new JBCXM__playbooktasks__c (  //Task having Task Due date as Date source Option and having dependancy on CTA due date
		JBCXM__PlaybookId__c = pidopportunity.id,
		JBCXM__DueDateSrc__c	=	ddsid.get(3).id,
		JBCXM__SkipOption__c = soid.get(0).id,
		JBCXM__DeltaDays__c = 3.0,
		JBCXM__DisplayOrder__c = 3.0,
		JBCXM__Priority__c = 'High',
		JBCXM__Status__c = 'Open',
		JBCXM__Subject__c = 'TASK_DUE_DATE_Skip_weekend_if_due_on_a_weekend_Opportunity_Playbook_'+(noofplaybboktask_Opportunity),
		JBCXM__Parent__c = parentid.get(0).id
		);
		pbtaskList4_Opportunity.add(pbtask4_Opportunity);
	insert pbtaskList4_Opportunity;


	List<JBCXM__playbooktasks__c> parentid1 = [SELECT id FROM JBCXM__playbooktasks__c where JBCXM__Subject__c =:pbtask4_Opportunity.JBCXM__Subject__c];
	JBCXM__playbooktasks__c pbtask5_Opportunity = new JBCXM__playbooktasks__c (  //Task having Task Close date as Date source Option and having dependancy on Task due date
		JBCXM__PlaybookId__c = pidopportunity.id,
		JBCXM__DueDateSrc__c	=	ddsid.get(4).id,
		JBCXM__SkipOption__c = soid.get(0).id,
		JBCXM__DeltaDays__c = 1.0,
		JBCXM__DisplayOrder__c = 4.0,
		JBCXM__Priority__c = 'Medium',
		JBCXM__Status__c = 'Open',
		JBCXM__Subject__c = 'TASK_CLOSE_DATE_Skip_weekend_if_due_on_a_weekend_Opportunity_Playbook_'+(noofplaybboktask_Opportunity),
		JBCXM__Parent__c = parentid1.get(0).id
		);
		noofplaybboktask_Opportunity++;
		pbtaskList5_Opportunity.add(pbtask5_Opportunity);
	insert pbtaskList5_Opportunity;
}